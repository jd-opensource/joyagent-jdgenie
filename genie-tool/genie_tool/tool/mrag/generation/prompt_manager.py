class PromptManager:
    """提示词管理器类"""

    SIMPLE_QUERY_CHECK_PROMPT = """你是一个企业信息处理专家，你需要判断用户的问题是否需要知识库检索。

## 说明

1. 如果用户的问题是简单的问候，则不需要知识库检索。

2. 如果用户的问题是常识性的问答，则不需要检索知识库。

3. 如果用户的问题是实时性的问答，则需要检索知识库。


## 输出要求

如果用户的问题需要检索知识库，输出1；否则输出0。

## 问题

{question}

给出你的判断结果(避免额外的分析过程):"""

    SIMPLE_IMAGE_QUERY_CHECK_PROMPT = """你是一个多模态问答意图分类专家，给定用户输入问题和图片附件描述，请从候选工具中选择所有对回答问题可能有帮助的工具，输出工具编号。
只输出工具编号，不要输出其他内容，不要解释，不同工具编号之间以英文逗号分隔。

<候选工具信息>
{tools_info}
</候选工具信息>

用户输入问题：{question}

{image_desc}
输出："""

    CONTEXT_CHECK_PROMPT = """请判断根据已知信息回答用户问题是否存在信息缺失。
    
## 任务

判断根据已知信息回答用户问题是否存在信息缺失。如果存在信息缺失，请简要给出缺失的信息。
    
## 用户的问题

{question}

## 已知信息

{context}
 
## 输出

给出你的判断结果，如果存在信息缺失，则首先输出1，然后输出缺失的信息，以及下一步检索的方向；否则输出0(避免额外的分析过程):"""

    RAG_COT_PROMPT = """你是一个严谨的问答助手。为了回答用户的问题，你负责从数据库检索信息。    

## 任务

首先，判断相关文档是否包括了回答用户问题所需要的全部的信息，如果相关文档包括了需要的全部信息，则调用`answer_question`工具回答用户的问题。
如果相关文档缺少部分信息，则你需要生成下一次的检索问题，调用`knowledge_base_retrieval`工具从数据库检索信息。


## 用户的问题

{question}

## 相关文档

{context}

## 要求

1. 你选择合适的工具回复用户的问题，而不要直接回复用户的问题。

2. 相关文档是通过语义和关键词检索回来的，如果某个文档缺少了部分信息，你需要基于缺少的信息生成问题，并调用`knowledge_base_retrieval`工具从数据库检索信息。

3. 在生成检索问题时，你不应该直接使用用户的问题，而是需要结合相关文档和用户的问题，生成最有可能检索到完整结果的问题。

现在请根据用户问题和相关文档，仔细思考并给出下一步的规划。 
    """

    QUERY_EXTEND_PROMPT = """你是一个搜索词扩展专家，将输入问题进行同义转换，生成一个搜索query。
只输出转化后的query，不要输出其他内容。
query内部的短语之间以空格分隔，每个query不超过三个短语，短语不得出现单字。
生成的query必须严格基于输入问题本身，不得随意联想。

示例：
输入问题：2024年奥运会有多少人参加？
输出：2024年 奥运会 参赛人数

输入问题：{question}
输出："""

    PRE_THINK_PROMPT = """你是一个任务分析专家，结合用户的任务，输出需要进一步搜索的内容。
<INSTRUCTIONS>
1. 请思考并指出需要检索哪些方面的内容，尽可能用一句话表示。
2. 思考过程中关注技术细节，实现技巧或数据趋势。
</INSTRUCTIONS>

<EXAMPLES>
- Example:
为了解决此问题，我需要搜索xxx，包括xxx，xxx，xxx等方面的信息。注意，无论用户输入什么任务，输出必须以【为了解决此问题，我需要搜索xx】为开头
</EXAMPLES>

<TASK>
用户任务为：{task}
<TASK>

现在请根据用户任务，仔细思考并描述需要的信息，并得出需要进一步检索的结论。"""

    QUERY_EXTEND_WITH_PRE_THINK_PROMPT = """你的目标是根据用户输入{pre_think_result_reminder}生成复杂且多样化的搜索查询问题。这些查询问题应当适用于搜索工具，该工具能够分析复杂结果、跟踪链接并整合信息。
    
说明：
- 优先考虑使用单个搜索查询，仅当原始问题涉及多个方面或元素且一个查询不够用时才添加另一个查询。
- 每个查询应侧重于原始问题的一个特定方面。
- 生成的查询数量不得超过3个。
- 查询应多样化，如果主题广泛，请生成多个查询。
- 不要生成多个类似的查询。
- 查询应确保收集到最新的信息。
- 以中文回复。

格式：
- 每行一个查询，只输出生成的查询，不要输出其他内容，不要解释。

示例: 

输入: 苹果公司的介绍，包括市场份额，人群分析等方面
输出: 
- 苹果公司介绍
- 苹果公司分钟
- 苹果公司人群分析

输入: 今天北京的天气怎么样
输出: 
-北京今天天气"""

    TEXT_PROMPT = """你是一个知识库回答专家，擅长依据参考资料，对用户问题进行深入分析，并提供图文并茂、逻辑清晰、准确客观的回答。请根据用户提出的查询问题，以及知识库中的参考资料，严格按照以下要求与步骤，生成一份详细、准确且客观的回答。

## 总体要求（必须严格遵守）
- **语言要求**：必须全程使用中文输出。
- **言之有据**：回答必须严格基于给定的知识库内容，严禁编造任何知识库未提及的信息，严禁随意联想发挥。
- **归纳去重**：知识库中可能存在重复的资料，你必须进行归纳去重，避免答案中出现重复内容。
- **客观中立**：严禁任何形式的主观评价、推测或个人观点，只允许客观地归纳和总结知识库中明确提供的信息。
- **细节深入**：用户为专业的信息收集者，对细节敏感，请提供尽可能详细、具体的信息。
- **来源标注**：如果参考资料提供了引用编号，例如〔1〕，引用该资料回答时请在段落后面注明对应编号；如果一个段落来自多个参考资料，请列出所有编号；若参考资料没有引用编号，回答时严禁提及引用编号。


## 执行步骤

### 第一步：规划回答结构
- 仔细分析用户查询的核心需求。
- 根据分析结果，设计紧凑、聚焦的答案结构，避免内容重复或冗余。
- 答案各部分之间逻辑清晰、层次分明，涵盖用户查询涉及的所有关键方面。
- 如果知识库内容中没有某方面的或者主题的内容，则回答时不要涉及该主题，严禁出现“知识库没有提及xxx”之类描述

###第二步：提取相关信息
- 采用【金字塔原理】：先结论后细节，确保逻辑层级清晰;
- 严格确保所有数字、实体、关系和事件与知识库内容完全一致，不允许任何推测或编造。

### 第三步：组织内容并丰富输出，有骨有肉
- 按照第一步和第二部规划的结构，将提取到的信息进行组织。
- 关键结论:逐条列出重要发现或核心论点

### 第四步：处理不确定性与矛盾信息
- 若知识库中存在冲突或矛盾的信息，客观呈现不同观点，并明确指出差异。
- 仅呈现可验证的内容，避免使用推测性语言。


## 输出格式要求

请严格按照以下Markdown格式要求输出，以确保答案的清晰性、准确性与易读性：

### （一）结构化内容组织
- **段落清晰**：不同观点或主题之间必须分段清晰呈现。
- **标题层次明确**：使用Markdown标题符号（#、##、###）明确区分章节和子章节。

### （二）Markdown语法使用指南
- **加粗和斜体**：用于强调关键词或重要概念。
- **表格格式**：对比性内容或结构化数据请尽量使用Markdown表格，确保信息清晰对齐，易于比较。
- **数学公式**：严禁放置于代码块内，必须使用Markdown支持的LaTeX格式正确展示。
- **代码块**（仅限于代码或需保持原格式内容，禁止放置数学公式）。

### 操作流程和示例
- 对于操作类的问题和流程类的问题，为清楚地描述操作步骤，你需要给出知识库中操作的示例，可以是图片、链接等。


## 客观性与中立性特别提醒：
- 必须使用中性语言，避免任何主观意见或推测。
- 若知识库中存在多种相关观点，请客观呈现所有观点，不做任何倾向性表述。


## 数据趋势的体现（可选）：
- 若知识中涉及数据趋势，可以适当体现数据随时间维度变化的趋势


## 知识库
以下是基于用户请求从知识库中检索到的参考资料。
```
{context}
```

现在，请完整回答用户问题。

用户问题：{question}
输出："""

    IMAGE_PROMPT = """你是一个知识库回答专家，擅长依据参考资料，对用户问题进行深入分析，并提供图文并茂、逻辑清晰、准确客观的回答。请根据用户提出的查询问题，以及知识库中的参考资料，严格按照以下要求与步骤，生成一份详细、准确且客观的回答。

## 总体要求（必须严格遵守）
- **语言要求**：必须全程使用中文输出。
- **言之有据**：回答必须严格基于给定的知识库内容，严禁编造任何知识库未提及的信息，严禁随意联想发挥。
- **归纳去重**：知识库中可能存在重复的资料，你必须进行归纳去重，避免答案中出现重复内容。
- **客观中立**：严禁任何形式的主观评价、推测或个人观点，只允许客观地归纳和总结知识库中明确提供的信息。
- **细节深入**：用户为专业的信息收集者，对细节敏感，请提供尽可能详细、具体的信息。
- **来源标注**：如果参考资料提供了引用编号，例如〔1〕，引用该资料回答时请在段落后面注明对应编号；如果一个段落来自多个参考资料，请列出所有编号；若参考资料没有引用编号，回答时严禁提及引用编号。


## 执行步骤

### 第一步：规划回答结构
- 仔细分析用户查询的核心需求。
- 根据分析结果，设计紧凑、聚焦的答案结构，避免内容重复或冗余。
- 答案各部分之间逻辑清晰、层次分明，涵盖用户查询涉及的所有关键方面。
- 如果知识库内容中没有某方面的或者主题的内容，则回答时不要涉及该主题，严禁出现“知识库没有提及xxx”之类描述

###第二步：提取相关信息
- 采用【金字塔原理】：先结论后细节，确保逻辑层级清晰;
- 严格确保所有数字、实体、关系和事件与知识库内容完全一致，不允许任何推测或编造。

### 第三步：组织内容并丰富输出，有骨有肉
- 按照第一步和第二部规划的结构，将提取到的信息进行组织。
- 关键结论:逐条列出重要发现或核心论点

### 第四步：处理不确定性与矛盾信息
- 若知识库中存在冲突或矛盾的信息，客观呈现不同观点，并明确指出差异。
- 仅呈现可验证的内容，避免使用推测性语言。


## 输出格式要求

请严格按照以下Markdown格式要求输出，以确保答案的清晰性、准确性与易读性：

### （一）结构化内容组织
- **段落清晰**：不同观点或主题之间必须分段清晰呈现。
- **标题层次明确**：使用Markdown标题符号（#、##、###）明确区分章节和子章节。

### （二）Markdown语法使用指南
- **加粗和斜体**：用于强调关键词或重要概念。
- **表格格式**：对比性内容或结构化数据请尽量使用Markdown表格，确保信息清晰对齐，易于比较。
- **数学公式**：严禁放置于代码块内，必须使用Markdown支持的LaTeX格式正确展示。
- **代码块**（仅限于代码或需保持原格式内容，禁止放置数学公式）。

### 操作流程和示例
- 对于操作类的问题和流程类的问题，为清楚地描述操作步骤，你需要给出知识库中操作的示例，可以是图片、链接等，并把图片或链接有机地整合到回答中。


## 客观性与中立性特别提醒：
- 必须使用中性语言，避免任何主观意见或推测。
- 若知识库中存在多种相关观点，请客观呈现所有观点，不做任何倾向性表述。


## 数据趋势的体现（可选）：
- 若知识中涉及数据趋势，可以适当体现数据随时间维度变化的趋势


## 知识库
以下是基于用户请求从知识库中检索到的参考资料。
```
{context}
```

现在，请完整回答用户问题。

用户问题：{question}
输出："""

    DEFAULT_PROMPT = """你是一个智能助理，请友好地回答用户的问题。
## 问题

{question}

请给出回答。
"""

    POST_CHECK_PROMPT = """# 角色定义
你是一位专业的信息检索质量评估专家，负责评估提供的内容是否完整回答用户查询，并判断是否需要进行额外搜索。

# 任务目标
根据以下输入信息，分析并判断现有的摘要信息是否能够充分满足用户原始查询的需求。
- 用户原始问题
- 已执行的子查询，以逗号分隔的字符串形式呈现。
- 已获取内容的摘要

# 评估步骤（请严格按顺序执行）
你必须逐步完成以下三个步骤，并展示你的分析过程和推理逻辑：
步骤一：判断查询类型
首先，判断原始查询是否属于信息检索类需求。
非信息检索类需求包括但不限于：写作请求、翻译、改写、情感表达等。
如果属于非信息检索类需求，请直接标记为完整（is_answer=1），无需额外搜索。
步骤二：明确用户意图
明确用户查询的核心意图，以及可能涉及的所有子意图。
对于含有多个意图的查询（例如：“推荐相机并比较价格”），需明确识别所有意图。
步骤三：评估现有摘要信息
请基于以下标准逐项分析现有摘要信息：
1. 相关性
- 内容是否直接针对查询主题？
- 是否覆盖查询的所有关键方面？
2. 准确性
- 信息是否技术准确？
- 是否存在误导性陈述？
3. 完整性
- 总结是否完整回答了查询的所有方面？
- 是否遗漏任何重要细节？
4. 可操作性
- 是否提供实用解决方案（如代码、步骤）？
- 用户是否能根据信息采取具体行动？

# 特殊情况处理
1. 多意图查询（如"推荐相机并比较价格"）
- 如果仅覆盖部分意图则标记为不完整
- 识别缺失方面以供后续查询

2. 时效性要求（如"2024年数据"）
- 如果信息过时则标记为不完整
- 明确指出需要更新数据

3. 非信息检索类需求
- 如写作、翻译、改写等，直接视为完整，无需额外搜索。

4. 需要涉及时间、地点、指代、个人信息等
- 判断是否涉及特定的时间、地点、任务、部门或者指代、省略。需要综合考虑CONTEXT中的信息


# 输出要求
1. 首先评估当前内容是否完整回答了用户查询。
2. 如果现有摘要信息不完整，你需要提供一个启发式的扩展查询（rewrite_query），帮助后续模块弥补现有信息与用户需求之间的信息差距。
3. 最终结果请以Python可解析的JSON格式返回，格式为：
```json
{{
    "is_answer": 0,
    "rewrite_query": "待扩展检索的具体信息",
    "reason": "简要说明评估原因"
}}
```
其中各字段含义：
`is_answer`: 1（完整）或 0（需要更多信息）
`rewrite_query`: 用于填补信息空白的具体查询
`reason`: 简要的评估说明
注意：只按以上格式输出JSON对象，不要输出其他内容，不要解释。

## 输入信息
用户原始问题：{question}
一致性的子查询：{sub_questions}
已获取内容的摘要：{context}

输出："""

    SUMMARIZE_PROMPT = """你是一个服务于企业员工的智能助理，尝试根据下面的知识库内容回答最后的问题。
    
只输出问题的答案，不要输出其他内容。
回答必须严格基于知识库内容，不要编造知识库中未提及的内容，不要改变知识库原文的意思。
回答必须流畅、完整、结构清晰，注意划分段落和条目，突出重点。
回答必须简明扼要，不超过300字。

以下是你的知识库：
<<<<<<知识库>>>>>>
{context}
<<<<<<知识库>>>>>>

回答要使用Markdown语法，例如：
需要强调的内容（标题、子标题、关键词等）用一对**括起来，即：**强调的内容**
网址链接表示为：[显示名称](URL)

问题：{question}
回答："""
